<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>刷视频</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; background: #000; }
        #video-list { height: 100vh; width: 100vw; overflow: hidden; position: relative; }
        .video-container { height: 100vh; width: 100vw; display: flex; flex-direction: column; align-items: center; justify-content: center; position: absolute; top: 0; left: 0; transition: transform 0.4s; }
        video { max-height: 80vh; max-width: 100vw; background: #000; }
        .title { color: #fff; font-size: 1.2em; position: absolute; top: 20px; left: 20px; z-index: 2; }
        .desc { color: #fff; font-size: 1em; position: absolute; bottom: 80px; left: 20px; z-index: 2; max-width: 80vw; }
    </style>
</head>
<body>
    <div id="video-list"></div>
    <script>
        let page = 1;
        let videos = [];
        let current = 0;
        let loading = false;

        function loadVideos(cb) {
            if (loading) return;
            loading = true;
            fetch(`/api/videos?page=${page}`)
                .then(res => res.json())
                .then(data => {
                    videos = videos.concat(data.videos);
                    if (cb) cb();
                    loading = false;
                });
        }

        function showVideo(idx) {
            if (idx < 0 || idx >= videos.length) return;
            current = idx;
            const v = videos[idx];
            document.getElementById('video-list').innerHTML = `
                <div class="video-container">
                    <div class="title">${v.title}</div>
                    <video src="${v.file_path}" controls autoplay loop></video>
                    <div class="desc">${v.description || ''}</div>
                </div>
            `;
        }

        // 键盘上下切换
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp') {
                if (current > 0) showVideo(current - 1);
            } else if (e.key === 'ArrowDown') {
                if (current < videos.length - 1) showVideo(current + 1);
                else {
                    page++;
                    loadVideos(() => showVideo(current + 1));
                }
            }
        });

        // 触摸滑动事件（移动端）
        let startY = 0;
        document.addEventListener('touchstart', e => startY = e.touches[0].clientY);
        document.addEventListener('touchend', e => {
            let endY = e.changedTouches[0].clientY;
            if (endY - startY > 50 && current > 0) showVideo(current - 1); // 下滑
            if (startY - endY > 50) {
                if (current < videos.length - 1) showVideo(current + 1);
                else {
                    page++;
                    loadVideos(() => showVideo(current + 1));
                }
            }
        });

        // 首次加载
        loadVideos(() => showVideo(0));
    </script>
</body>
</html> 